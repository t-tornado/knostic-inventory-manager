<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stores - Knostic</title>

    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --secondary: #8b5cf6;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #3b82f6;
        --bg-primary: #ffffff;
        --bg-secondary: #f8fafc;
        --bg-tertiary: #f1f5f9;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --text-tertiary: #94a3b8;
        --border: #e2e8f0;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --radius: 12px;
        --radius-sm: 8px;
      }

      /* Dark mode variables */
      [data-theme="dark"] {
        --bg-primary: #1e293b;
        --bg-secondary: #0f172a;
        --bg-tertiary: #1e293b;
        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --text-tertiary: #94a3b8;
        --border: #334155;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4),
          0 2px 4px -1px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4),
          0 4px 6px -2px rgba(0, 0, 0, 0.3);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.4),
          0 10px 10px -5px rgba(0, 0, 0, 0.3);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: var(--bg-secondary);
        color: var(--text-primary);
        line-height: 1.6;
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: 280px;
        background: var(--bg-primary);
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        position: fixed;
        height: 100vh;
        left: 0;
        top: 0;
        z-index: 1000;
        transition: transform 0.3s ease;
        box-shadow: var(--shadow-md);
      }

      .sidebar-header {
        padding: 24px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .sidebar-logo {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        font-weight: 700;
      }

      .sidebar-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--text-primary);
      }

      .sidebar-nav {
        flex: 1;
        padding: 16px;
        overflow-y: auto;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        border-radius: var(--radius-sm);
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.2s;
        margin-bottom: 4px;
        cursor: pointer;
      }

      .nav-item:hover {
        background: var(--bg-secondary);
        color: var(--text-primary);
      }

      .nav-item.active {
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary);
      }

      .nav-item.active i {
        color: var(--primary);
      }

      .nav-item i {
        width: 20px;
        text-align: center;
        font-size: 18px;
        color: var(--text-tertiary);
        transition: color 0.2s;
      }

      .nav-item:hover i {
        color: var(--primary);
      }

      .sidebar-footer {
        padding: 16px;
        border-top: 1px solid var(--border);
      }

      .user-profile {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        border-radius: var(--radius-sm);
        transition: background 0.2s;
        cursor: pointer;
      }

      .user-profile:hover {
        background: var(--bg-secondary);
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 16px;
      }

      .user-info {
        flex: 1;
      }

      .user-name {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 14px;
      }

      .user-role {
        font-size: 12px;
        color: var(--text-secondary);
      }

      .sidebar-toggle {
        display: none;
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1001;
        width: 40px;
        height: 40px;
        background: var(--bg-primary);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: var(--shadow-md);
        color: var(--text-primary);
        font-size: 18px;
      }

      .main-content {
        flex: 1;
        margin-left: 280px;
        transition: margin-left 0.3s ease;
      }

      .dashboard-container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 24px;
      }

      /* Header */
      .header {
        background: var(--bg-primary);
        border-radius: var(--radius);
        padding: 24px 32px;
        margin-bottom: 24px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08),
          0 2px 8px rgba(0, 0, 0, 0.04), 0 0 0 1px rgba(0, 0, 0, 0.02);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      [data-theme="dark"] .header {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2),
          0 0 0 1px rgba(255, 255, 255, 0.05);
      }

      .header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--bg-primary);
        opacity: 0.95;
        border-radius: var(--radius);
        z-index: -1;
      }

      .header h1 {
        font-size: 28px;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .header h1 i {
        color: var(--primary);
      }

      .header-actions {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .theme-toggle {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        background: var(--bg-primary);
        color: var(--text-primary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        font-size: 18px;
      }

      .theme-toggle:hover {
        background: var(--bg-tertiary);
        transform: scale(1.05);
        border-color: var(--primary);
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: var(--radius-sm);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn-secondary {
        background: var(--bg-tertiary);
        color: var(--text-primary);
      }

      .btn-secondary:hover {
        background: var(--border);
      }

      /* Table Container */
      .table-container {
        background: var(--bg-primary);
        border-radius: var(--radius);
        padding: 24px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
      }

      /* Table Controls */
      .table-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        margin-bottom: 24px;
        align-items: center;
      }

      .search-box {
        flex: 1;
        min-width: 250px;
        position: relative;
      }

      .search-box input {
        width: 100%;
        padding: 10px 16px 10px 40px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 14px;
        transition: all 0.2s;
      }

      .search-box input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .search-box i {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-tertiary);
      }

      .filter-group {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .filter-item {
        display: flex;
        gap: 8px;
        align-items: center;
        padding: 8px 12px;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
      }

      .filter-label {
        font-size: 13px;
        font-weight: 500;
        color: var(--text-secondary);
        white-space: nowrap;
      }

      .filter-operator {
        padding: 8px 12px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
        min-width: 120px;
      }

      .filter-operator:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .filter-value {
        padding: 8px 12px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 13px;
        transition: all 0.2s;
        min-width: 150px;
      }

      .filter-value:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .filter-value[type="date"] {
        min-width: 160px;
      }

      .filter-remove {
        padding: 6px 10px;
        border: none;
        border-radius: var(--radius-sm);
        background: var(--danger);
        color: white;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .filter-remove:hover {
        background: #dc2626;
        transform: scale(1.05);
      }

      .add-filter-btn {
        position: relative;
        width: 40px;
        height: 40px;
        padding: 0;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 16px;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .add-filter-btn:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: var(--bg-secondary);
      }

      .add-filter-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      .filter-badge {
        position: absolute;
        top: -6px;
        right: -6px;
        background: var(--danger);
        color: white;
        border-radius: 10px;
        min-width: 18px;
        height: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 600;
        padding: 0 4px;
        border: 2px solid var(--bg-primary);
      }

      .filter-badge.hidden {
        display: none;
      }

      /* Filter Popover */
      .filter-popover {
        position: absolute;
        top: calc(100% + 8px);
        right: 0;
        background: var(--bg-primary);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow-xl);
        width: 700px;
        max-width: calc(100vw - 40px);
        max-height: 80vh;
        display: none;
        flex-direction: column;
        overflow: hidden;
        z-index: 2000;
      }

      .filter-popover.show {
        display: flex;
      }

      .filter-popover-header {
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .filter-popover-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .filter-popover-close {
        width: 28px;
        height: 28px;
        border: none;
        background: var(--bg-tertiary);
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        transition: all 0.2s;
        font-size: 14px;
      }

      .filter-popover-close:hover {
        background: var(--border);
        color: var(--text-primary);
      }

      .filter-popover-body {
        padding: 20px;
        overflow-y: auto;
        flex: 1;
        max-height: calc(80vh - 140px);
      }

      .filter-popover-footer {
        padding: 12px 20px;
        border-top: 1px solid var(--border);
        display: flex;
        justify-content: flex-end;
        gap: 12px;
      }

      .filter-row {
        display: grid;
        grid-template-columns: 180px 150px 1fr auto;
        gap: 12px;
        align-items: center;
        padding: 12px;
        background: var(--bg-secondary);
        border-radius: var(--radius-sm);
        margin-bottom: 12px;
      }

      .filter-row-field,
      .filter-row-operator {
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .filter-row-field:focus,
      .filter-row-operator:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .filter-row-value {
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 14px;
        transition: all 0.2s;
      }

      .filter-row-value:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .filter-row-value[type="date"] {
        min-width: 160px;
      }

      .filter-row-remove {
        width: 36px;
        height: 36px;
        border: none;
        background: var(--danger);
        color: white;
        border-radius: var(--radius-sm);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .filter-row-remove:hover {
        background: #dc2626;
        transform: scale(1.05);
      }

      .filter-row-between {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .filter-row-between input {
        flex: 1;
      }

      .filter-row-between span {
        color: var(--text-secondary);
        font-size: 13px;
      }

      .add-filter-row-btn {
        width: 100%;
        padding: 12px;
        border: 2px dashed var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.2s;
        margin-top: 8px;
      }

      .add-filter-row-btn:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: var(--bg-secondary);
      }

      .calendar-container {
        position: relative;
      }

      .calendar-input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 14px;
        cursor: pointer;
      }

      .calendar-popup {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        background: var(--bg-primary);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow-lg);
        padding: 16px;
        z-index: 10;
        display: none;
        min-width: 300px;
      }

      .calendar-popup.show {
        display: block;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .calendar-nav {
        width: 32px;
        height: 32px;
        border: none;
        background: var(--bg-secondary);
        border-radius: var(--radius-sm);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-primary);
        transition: all 0.2s;
      }

      .calendar-nav:hover {
        background: var(--bg-tertiary);
      }

      .calendar-month-year {
        font-weight: 600;
        color: var(--text-primary);
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 4px;
      }

      .calendar-day-header {
        text-align: center;
        font-size: 12px;
        font-weight: 600;
        color: var(--text-secondary);
        padding: 8px 4px;
      }

      .calendar-day {
        aspect-ratio: 1;
        border: none;
        background: transparent;
        border-radius: var(--radius-sm);
        cursor: pointer;
        font-size: 13px;
        color: var(--text-primary);
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .calendar-day:hover {
        background: var(--bg-secondary);
      }

      .calendar-day.selected {
        background: var(--primary);
        color: white;
      }

      .calendar-day.other-month {
        color: var(--text-tertiary);
      }

      .calendar-day.today {
        border: 2px solid var(--primary);
      }

      .column-toggle {
        position: relative;
      }

      .column-toggle-btn {
        padding: 10px 16px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-primary);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        transition: all 0.2s;
      }

      .column-toggle-btn:hover {
        background: var(--bg-tertiary);
        border-color: var(--primary);
      }

      .column-dropdown {
        position: absolute;
        top: calc(100% + 8px);
        right: 0;
        background: var(--bg-primary);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        box-shadow: var(--shadow-lg);
        padding: 8px;
        min-width: 200px;
        z-index: 10;
        display: none;
      }

      .column-dropdown.show {
        display: block;
      }

      .column-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: background 0.2s;
      }

      .column-item:hover {
        background: var(--bg-secondary);
      }

      .column-item input[type="checkbox"] {
        cursor: pointer;
      }

      .column-item label {
        cursor: pointer;
        flex: 1;
        font-size: 14px;
        color: var(--text-primary);
      }

      /* Table */
      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 24px;
      }

      .data-table thead {
        background: var(--bg-secondary);
      }

      .data-table th {
        padding: 12px 16px;
        text-align: left;
        font-weight: 600;
        font-size: 13px;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 2px solid var(--border);
        cursor: pointer;
        user-select: none;
        position: relative;
      }

      .data-table th:hover {
        background: var(--bg-tertiary);
      }

      .data-table th.sortable {
        padding-right: 32px;
      }

      .data-table th .sort-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-tertiary);
        font-size: 12px;
      }

      .data-table th.sort-asc .sort-icon::before {
        content: "\f0de";
        color: var(--primary);
      }

      .data-table th.sort-desc .sort-icon::before {
        content: "\f0dd";
        color: var(--primary);
      }

      .data-table tbody tr {
        border-bottom: 1px solid var(--border);
        transition: background 0.2s;
      }

      .data-table tbody tr:hover {
        background: var(--bg-secondary);
      }

      .data-table td {
        padding: 16px;
        font-size: 14px;
        color: var(--text-primary);
      }

      .data-table td.actions {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        padding: 6px 12px;
        border: none;
        border-radius: var(--radius-sm);
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .action-btn.edit {
        background: rgba(59, 130, 246, 0.1);
        color: var(--info);
      }

      .action-btn.edit:hover {
        background: var(--info);
        color: white;
      }

      .action-btn.delete {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
      }

      .action-btn.delete:hover {
        background: var(--danger);
        color: white;
      }

      .action-btn.view {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
      }

      .action-btn.view:hover {
        background: var(--success);
        color: white;
      }

      /* Pagination */
      .pagination {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 16px;
      }

      .pagination-info {
        font-size: 14px;
        color: var(--text-secondary);
      }

      .pagination-controls {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .pagination-btn {
        padding: 8px 12px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-primary);
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .pagination-btn:hover:not(:disabled) {
        background: var(--bg-tertiary);
        border-color: var(--primary);
      }

      .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .pagination-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      .page-size-select {
        padding: 8px 12px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 14px;
        cursor: pointer;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
      }

      .empty-state i {
        font-size: 48px;
        color: var(--text-tertiary);
        margin-bottom: 16px;
      }

      .empty-state h3 {
        font-size: 18px;
        margin-bottom: 8px;
        color: var(--text-primary);
      }

      .empty-state p {
        font-size: 14px;
      }

      /* Loading State */
      .loading-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
      }

      .loading-spinner {
        border: 3px solid var(--border);
        border-top: 3px solid var(--primary);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 16px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.open {
          transform: translateX(0);
        }

        .sidebar-toggle {
          display: flex;
        }

        .main-content {
          margin-left: 0;
        }

        .dashboard-container {
          padding: 16px;
          padding-top: 70px;
        }

        .header {
          flex-direction: column;
          align-items: flex-start;
          gap: 16px;
          padding: 16px 20px;
          top: 0;
          border-radius: 0;
          margin-bottom: 16px;
        }

        .header::before {
          border-radius: 0;
        }

        .table-controls {
          flex-direction: column;
        }

        .search-box {
          width: 100%;
        }

        .filter-popover {
          width: calc(100vw - 32px);
          right: 0;
          left: 0;
          max-width: none;
        }

        .filter-row {
          grid-template-columns: 1fr;
          gap: 8px;
        }

        .filter-row-field,
        .filter-row-operator {
          width: 100%;
        }

        .data-table {
          font-size: 12px;
        }

        .data-table th,
        .data-table td {
          padding: 8px;
        }

        .data-table td.actions {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar Toggle (Mobile) -->
    <button class="sidebar-toggle" id="sidebarToggle">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">K</div>
        <div class="sidebar-title">Knostic</div>
      </div>
      <nav class="sidebar-nav">
        <a href="#dashboard" class="nav-item" data-page="dashboard">
          <i class="fas fa-chart-line"></i>
          <span>Dashboard</span>
        </a>
        <a href="#stores" class="nav-item active" data-page="stores">
          <i class="fas fa-store"></i>
          <span>Stores</span>
        </a>
        <a href="#products" class="nav-item" data-page="products">
          <i class="fas fa-box"></i>
          <span>Products</span>
        </a>
      </nav>
      <div class="sidebar-footer">
        <div class="user-profile">
          <div class="user-avatar">JD</div>
          <div class="user-info">
            <div class="user-name">John Doe</div>
            <div class="user-role">Administrator</div>
          </div>
          <i
            class="fas fa-chevron-down"
            style="font-size: 12px; color: var(--text-tertiary)"
          ></i>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
          <h1>
            <i class="fas fa-store"></i>
            Stores
          </h1>
          <div class="header-actions">
            <button
              class="theme-toggle"
              id="themeToggle"
              title="Toggle dark mode"
            >
              <i class="fas fa-moon" id="themeIcon"></i>
            </button>
            <button class="btn btn-secondary">
              <i class="fas fa-download"></i>
              Export
            </button>
            <button class="btn btn-primary">
              <i class="fas fa-plus"></i>
              New Store
            </button>
          </div>
        </div>

        <!-- Table Container -->
        <div class="table-container">
          <!-- Table Controls -->
          <div class="table-controls">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input
                type="text"
                id="searchInput"
                placeholder="Search stores..."
              />
            </div>
            <div class="column-toggle" style="position: relative">
              <button class="add-filter-btn" id="addFilterBtn" title="Filters">
                <i class="fas fa-filter"></i>
                <span class="filter-badge hidden" id="filterCount">0</span>
              </button>
              <div class="filter-popover" id="filterPopover">
                <div class="filter-popover-header">
                  <div class="filter-popover-title">
                    <i class="fas fa-filter"></i>
                    Filters
                  </div>
                  <button class="filter-popover-close" id="popoverClose">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <div class="filter-popover-body" id="popoverBody">
                  <!-- Filter rows will be inserted here -->
                </div>
                <div class="filter-popover-footer">
                  <button class="btn btn-secondary" id="clearFiltersBtn">
                    Clear All
                  </button>
                  <button class="btn btn-primary" id="applyFiltersBtn">
                    Apply Filters
                  </button>
                </div>
              </div>
            </div>
            <div class="column-toggle">
              <button class="column-toggle-btn" id="columnToggleBtn">
                <i class="fas fa-columns"></i>
                Columns
              </button>
              <div class="column-dropdown" id="columnDropdown"></div>
            </div>
          </div>

          <!-- Data Table -->
          <div id="tableWrapper">
            <table class="data-table" id="dataTable">
              <thead id="tableHead"></thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div class="pagination">
            <div class="pagination-info" id="paginationInfo"></div>
            <div class="pagination-controls">
              <button class="pagination-btn" id="prevBtn">
                <i class="fas fa-chevron-left"></i>
                Previous
              </button>
              <div id="pageNumbers"></div>
              <button class="pagination-btn" id="nextBtn">
                Next
                <i class="fas fa-chevron-right"></i>
              </button>
              <select class="page-size-select" id="pageSizeSelect">
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // Dark mode functionality
      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.getElementById("themeIcon");
      const html = document.documentElement;

      function updateThemeIcon(theme) {
        if (theme === "dark") {
          themeIcon.classList.remove("fa-moon");
          themeIcon.classList.add("fa-sun");
        } else {
          themeIcon.classList.remove("fa-sun");
          themeIcon.classList.add("fa-moon");
        }
      }

      const currentTheme = localStorage.getItem("theme") || "light";
      html.setAttribute("data-theme", currentTheme);
      updateThemeIcon(currentTheme);

      themeToggle.addEventListener("click", function () {
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        html.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
        updateThemeIcon(newTheme);
      });

      // Sidebar toggle for mobile
      const sidebarToggle = document.getElementById("sidebarToggle");
      const sidebar = document.getElementById("sidebar");

      sidebarToggle.addEventListener("click", function () {
        sidebar.classList.toggle("open");
      });

      document.addEventListener("click", function (event) {
        if (
          window.innerWidth <= 768 &&
          sidebar.classList.contains("open") &&
          !sidebar.contains(event.target) &&
          !sidebarToggle.contains(event.target)
        ) {
          sidebar.classList.remove("open");
        }
      });

      // Navigation handling
      document.querySelectorAll(".nav-item").forEach((item) => {
        item.addEventListener("click", function (e) {
          e.preventDefault();
          document.querySelectorAll(".nav-item").forEach((nav) => {
            nav.classList.remove("active");
          });
          this.classList.add("active");
        });
      });

      // Operator definitions
      const OPERATORS = {
        string: [
          { value: "contains", label: "Contains" },
          { value: "equals", label: "Equals" },
          { value: "startsWith", label: "Starts with" },
          { value: "endsWith", label: "Ends with" },
          { value: "notContains", label: "Does not contain" },
        ],
        number: [
          { value: "equals", label: "Equals" },
          { value: "greaterThan", label: "Greater than" },
          { value: "lessThan", label: "Less than" },
          { value: "greaterThanOrEqual", label: "Greater or equal" },
          { value: "lessThanOrEqual", label: "Less or equal" },
          { value: "notEquals", label: "Not equals" },
        ],
        date: [
          { value: "equals", label: "Equals" },
          { value: "before", label: "Before" },
          { value: "after", label: "After" },
          { value: "between", label: "Between" },
        ],
      };

      // Reusable DataTable Component
      class DataTable {
        constructor(config) {
          this.schema = config.schema; // Array of column definitions
          this.data = config.data || [];
          this.container = config.container;
          this.onRowClick = config.onRowClick;
          this.onAction = config.onAction;

          // State - filters now store {field, operator, value} objects
          this.state = {
            search: "",
            filters: [], // Array of filter objects
            sortColumn: null,
            sortDirection: "asc",
            visibleColumns: this.schema
              .filter((col) => col.key !== "actions")
              .map((col) => col.key),
            currentPage: 1,
            pageSize: 25,
          };

          // Load state from URL
          this.loadStateFromURL();

          this.init();
        }

        init() {
          this.renderControls();
          this.renderTable();
          this.renderPagination();
          this.attachEventListeners();
          this.updateURL();
        }

        loadStateFromURL() {
          const params = new URLSearchParams(window.location.search);
          if (params.get("search")) {
            this.state.search = params.get("search");
          }
          if (params.get("sort")) {
            this.state.sortColumn = params.get("sort");
          }
          if (params.get("order")) {
            this.state.sortDirection = params.get("order");
          }
          if (params.get("page")) {
            this.state.currentPage = parseInt(params.get("page")) || 1;
          }
          if (params.get("pageSize")) {
            this.state.pageSize = parseInt(params.get("pageSize")) || 25;
          }
          if (params.get("columns")) {
            this.state.visibleColumns = params.get("columns").split(",");
          }
          // Load filters from URL
          const filterParam = params.get("filters");
          if (filterParam) {
            try {
              this.state.filters = JSON.parse(decodeURIComponent(filterParam));
            } catch (e) {
              this.state.filters = [];
            }
          }
        }

        updateURL() {
          const params = new URLSearchParams();
          if (this.state.search) {
            params.set("search", this.state.search);
          }
          if (this.state.sortColumn) {
            params.set("sort", this.state.sortColumn);
            params.set("order", this.state.sortDirection);
          }
          if (this.state.currentPage > 1) {
            params.set("page", this.state.currentPage);
          }
          if (this.state.pageSize !== 25) {
            params.set("pageSize", this.state.pageSize);
          }
          const allColumns = this.schema
            .filter((col) => col.key !== "actions")
            .map((col) => col.key);
          if (
            this.state.visibleColumns.length !== allColumns.length ||
            !this.state.visibleColumns.every((col) => allColumns.includes(col))
          ) {
            params.set("columns", this.state.visibleColumns.join(","));
          }
          if (this.state.filters.length > 0) {
            params.set(
              "filters",
              encodeURIComponent(JSON.stringify(this.state.filters))
            );
          }
          window.history.replaceState(
            {},
            "",
            `${window.location.pathname}?${params.toString()}`
          );
        }

        getFieldType(col) {
          if (col.type) return col.type;
          // Infer type from data
          if (this.data.length > 0) {
            const sample = this.data[0][col.key];
            if (
              sample instanceof Date ||
              col.key.includes("date") ||
              col.key.includes("Date") ||
              col.key.includes("At")
            ) {
              return "date";
            }
            if (typeof sample === "number") {
              return "number";
            }
            return "string";
          }
          return "string";
        }

        renderControls() {
          // Search
          const searchInput = document.getElementById("searchInput");
          if (searchInput) {
            searchInput.value = this.state.search;
          }

          // Update filter count badge
          this.updateFilterCount();

          // Column toggle
          this.renderColumnDropdown();
        }

        renderFiltersPopover() {
          const popoverBody = document.getElementById("popoverBody");
          if (!popoverBody) return;

          popoverBody.innerHTML = "";

          // Render existing filters
          this.state.filters.forEach((filter, index) => {
            const filterRow = this.createFilterRow(
              filter.field,
              filter.operator,
              filter.value,
              index
            );
            popoverBody.appendChild(filterRow);
          });

          // Add "Add Filter" button
          const addBtn = document.createElement("button");
          addBtn.className = "add-filter-row-btn";
          addBtn.innerHTML = '<i class="fas fa-plus"></i> Add Filter';
          addBtn.addEventListener("click", () => {
            this.addFilterRow();
          });
          popoverBody.appendChild(addBtn);
        }

        updateFilterCount() {
          const filterCount = document.getElementById("filterCount");
          const filterBtn = document.getElementById("addFilterBtn");
          if (filterCount) {
            if (this.state.filters.length > 0) {
              filterCount.textContent = this.state.filters.length;
              filterCount.classList.remove("hidden");
              if (filterBtn) {
                filterBtn.classList.add("active");
              }
            } else {
              filterCount.classList.add("hidden");
              if (filterBtn) {
                filterBtn.classList.remove("active");
              }
            }
          }
        }

        createFilterRow(fieldKey, operator, value, index) {
          const col = this.schema.find((c) => c.key === fieldKey);
          if (!col) return null;

          const fieldType = this.getFieldType(col);
          const operators = OPERATORS[fieldType] || OPERATORS.string;

          const filterRow = document.createElement("div");
          filterRow.className = "filter-row";
          filterRow.dataset.filterIndex = index;

          // Field select
          const fieldSelect = document.createElement("select");
          fieldSelect.className = "filter-row-field";
          this.schema
            .filter((c) => c.key !== "actions")
            .forEach((c) => {
              const option = document.createElement("option");
              option.value = c.key;
              option.textContent = c.label;
              if (c.key === fieldKey) {
                option.selected = true;
              }
              fieldSelect.appendChild(option);
            });
          fieldSelect.addEventListener("change", () => {
            const newCol = this.schema.find((c) => c.key === fieldSelect.value);
            const newFieldType = this.getFieldType(newCol);
            const newOperators = OPERATORS[newFieldType] || OPERATORS.string;
            this.state.filters[index].field = fieldSelect.value;
            this.state.filters[index].operator = newOperators[0].value;
            this.state.filters[index].value = "";
            this.renderFiltersPopover();
          });
          filterRow.appendChild(fieldSelect);

          // Operator select
          const operatorSelect = document.createElement("select");
          operatorSelect.className = "filter-row-operator";
          operators.forEach((op) => {
            const option = document.createElement("option");
            option.value = op.value;
            option.textContent = op.label;
            if (op.value === operator) {
              option.selected = true;
            }
            operatorSelect.appendChild(option);
          });
          operatorSelect.addEventListener("change", () => {
            this.state.filters[index].operator = operatorSelect.value;
            if (operatorSelect.value === "between" && fieldType === "date") {
              this.state.filters[index].value = ",";
            } else if (operatorSelect.value !== "between") {
              this.state.filters[index].value = "";
            }
            this.renderFiltersPopover();
          });
          filterRow.appendChild(operatorSelect);

          // Value input container
          const valueContainer = document.createElement("div");
          valueContainer.style.flex = "1";
          this.renderFilterValueInput(
            valueContainer,
            fieldType,
            value,
            index,
            operatorSelect.value === "between"
          );
          filterRow.appendChild(valueContainer);

          // Remove button
          const removeBtn = document.createElement("button");
          removeBtn.className = "filter-row-remove";
          removeBtn.innerHTML = '<i class="fas fa-times"></i>';
          removeBtn.title = "Remove filter";
          removeBtn.addEventListener("click", () => {
            this.state.filters.splice(index, 1);
            this.renderFiltersPopover();
            this.updateFilterCount();
          });
          filterRow.appendChild(removeBtn);

          return filterRow;
        }

        renderFilterValueInput(
          container,
          fieldType,
          value,
          filterIndex,
          isBetween
        ) {
          container.innerHTML = "";

          if (isBetween && fieldType === "date") {
            const betweenContainer = document.createElement("div");
            betweenContainer.className = "filter-row-between";
            const value1 =
              value && value.split(",")[0] ? value.split(",")[0] : "";
            const value2 =
              value && value.split(",")[1] ? value.split(",")[1] : "";

            const input1 = this.createDateInput(value1, (newValue) => {
              const currentValue = this.state.filters[filterIndex].value || "";
              const parts = currentValue.split(",");
              this.state.filters[filterIndex].value = `${newValue},${
                parts[1] || ""
              }`;
            });
            betweenContainer.appendChild(input1);

            const span = document.createElement("span");
            span.textContent = "and";
            betweenContainer.appendChild(span);

            const input2 = this.createDateInput(value2, (newValue) => {
              const currentValue = this.state.filters[filterIndex].value || "";
              const parts = currentValue.split(",");
              this.state.filters[filterIndex].value = `${
                parts[0] || ""
              },${newValue}`;
            });
            betweenContainer.appendChild(input2);

            container.appendChild(betweenContainer);
          } else if (fieldType === "date") {
            container.appendChild(
              this.createDateInput(value || "", (newValue) => {
                this.state.filters[filterIndex].value = newValue;
              })
            );
          } else {
            const input = document.createElement("input");
            input.type = fieldType === "number" ? "number" : "text";
            input.className = "filter-row-value";
            input.value = value || "";
            input.placeholder = `Enter ${
              fieldType === "number" ? "number" : "value"
            }`;
            input.addEventListener("input", (e) => {
              this.state.filters[filterIndex].value = e.target.value;
            });
            container.appendChild(input);
          }
        }

        createDateInput(value, onChange) {
          const container = document.createElement("div");
          container.className = "calendar-container";

          const input = document.createElement("input");
          input.type = "text";
          input.className = "filter-row-value calendar-input";
          input.value = value ? new Date(value).toLocaleDateString() : "";
          input.placeholder = "Select date";
          input.readOnly = true;

          const calendar = this.createCalendar(value, (selectedDate) => {
            input.value = selectedDate.toLocaleDateString();
            onChange(selectedDate.toISOString().split("T")[0]);
            calendar.classList.remove("show");
          });

          input.addEventListener("click", (e) => {
            e.stopPropagation();
            calendar.classList.toggle("show");
          });

          document.addEventListener("click", (e) => {
            if (!container.contains(e.target)) {
              calendar.classList.remove("show");
            }
          });

          container.appendChild(input);
          container.appendChild(calendar);
          return container;
        }

        createCalendar(selectedDate, onSelect) {
          const popup = document.createElement("div");
          popup.className = "calendar-popup";

          let currentDate = selectedDate ? new Date(selectedDate) : new Date();
          let viewDate = new Date(currentDate);

          const renderCalendar = () => {
            popup.innerHTML = "";

            const header = document.createElement("div");
            header.className = "calendar-header";

            const prevBtn = document.createElement("button");
            prevBtn.className = "calendar-nav";
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.addEventListener("click", () => {
              viewDate.setMonth(viewDate.getMonth() - 1);
              renderCalendar();
            });
            header.appendChild(prevBtn);

            const monthYear = document.createElement("div");
            monthYear.className = "calendar-month-year";
            monthYear.textContent = viewDate.toLocaleDateString("en-US", {
              month: "long",
              year: "numeric",
            });
            header.appendChild(monthYear);

            const nextBtn = document.createElement("button");
            nextBtn.className = "calendar-nav";
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.addEventListener("click", () => {
              viewDate.setMonth(viewDate.getMonth() + 1);
              renderCalendar();
            });
            header.appendChild(nextBtn);

            popup.appendChild(header);

            const grid = document.createElement("div");
            grid.className = "calendar-grid";

            // Day headers
            const dayHeaders = [
              "Sun",
              "Mon",
              "Tue",
              "Wed",
              "Thu",
              "Fri",
              "Sat",
            ];
            dayHeaders.forEach((day) => {
              const header = document.createElement("div");
              header.className = "calendar-day-header";
              header.textContent = day;
              grid.appendChild(header);
            });

            // Get first day of month and number of days
            const firstDay = new Date(
              viewDate.getFullYear(),
              viewDate.getMonth(),
              1
            );
            const lastDay = new Date(
              viewDate.getFullYear(),
              viewDate.getMonth() + 1,
              0
            );
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();

            // Empty cells for days before month starts
            for (let i = 0; i < startingDayOfWeek; i++) {
              const empty = document.createElement("div");
              grid.appendChild(empty);
            }

            // Days of the month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
              const dayBtn = document.createElement("button");
              dayBtn.className = "calendar-day";
              dayBtn.textContent = day;

              const cellDate = new Date(
                viewDate.getFullYear(),
                viewDate.getMonth(),
                day
              );
              if (cellDate.toDateString() === today.toDateString()) {
                dayBtn.classList.add("today");
              }
              if (
                selectedDate &&
                cellDate.toDateString() ===
                  new Date(selectedDate).toDateString()
              ) {
                dayBtn.classList.add("selected");
              }

              dayBtn.addEventListener("click", () => {
                onSelect(cellDate);
              });

              grid.appendChild(dayBtn);
            }

            popup.appendChild(grid);
          };

          renderCalendar();
          return popup;
        }

        addFilterRow() {
          const availableFields = this.schema.filter(
            (col) => col.key !== "actions"
          );

          if (availableFields.length === 0) return;

          const firstField = availableFields[0];
          const fieldType = this.getFieldType(firstField);
          const operators = OPERATORS[fieldType] || OPERATORS.string;

          this.state.filters.push({
            field: firstField.key,
            operator: operators[0].value,
            value: "",
          });

          this.renderFiltersPopover();
        }

        renderColumnDropdown() {
          const dropdown = document.getElementById("columnDropdown");
          if (!dropdown) return;

          dropdown.innerHTML = "";
          this.schema.forEach((col) => {
            const item = document.createElement("div");
            item.className = "column-item";
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.id = `col_${col.key}`;
            checkbox.checked = this.state.visibleColumns.includes(col.key);
            checkbox.addEventListener("change", () => {
              if (checkbox.checked) {
                this.state.visibleColumns.push(col.key);
              } else {
                this.state.visibleColumns = this.state.visibleColumns.filter(
                  (k) => k !== col.key
                );
              }
              this.renderTable();
              this.updateURL();
            });
            const label = document.createElement("label");
            label.htmlFor = `col_${col.key}`;
            label.textContent = col.label;
            item.appendChild(checkbox);
            item.appendChild(label);
            dropdown.appendChild(item);
          });
        }

        renderTable() {
          const head = document.getElementById("tableHead");
          const body = document.getElementById("tableBody");
          if (!head || !body) return;

          // Render header
          head.innerHTML = "";
          const headerRow = document.createElement("tr");
          this.schema
            .filter((col) => this.state.visibleColumns.includes(col.key))
            .forEach((col) => {
              const th = document.createElement("th");
              th.textContent = col.label;
              if (col.sortable !== false) {
                th.className = "sortable";
                if (this.state.sortColumn === col.key) {
                  th.classList.add(`sort-${this.state.sortDirection}`);
                }
                th.innerHTML = `${col.label}<span class="sort-icon"></span>`;
                th.addEventListener("click", () => {
                  if (this.state.sortColumn === col.key) {
                    this.state.sortDirection =
                      this.state.sortDirection === "asc" ? "desc" : "asc";
                  } else {
                    this.state.sortColumn = col.key;
                    this.state.sortDirection = "asc";
                  }
                  this.state.currentPage = 1;
                  this.renderTable();
                  this.renderPagination();
                  this.updateURL();
                });
              } else {
                th.textContent = col.label;
              }
              headerRow.appendChild(th);
            });
          if (this.schema.some((col) => col.actions)) {
            const th = document.createElement("th");
            th.textContent = "Actions";
            headerRow.appendChild(th);
          }
          head.appendChild(headerRow);

          // Render body
          body.innerHTML = "";
          const filteredData = this.getFilteredData();
          const paginatedData = this.getPaginatedData(filteredData);

          if (paginatedData.length === 0) {
            const row = document.createElement("tr");
            const cell = document.createElement("td");
            cell.colSpan = this.state.visibleColumns.length + 1;
            cell.className = "empty-state";
            cell.innerHTML = `
              <i class="fas fa-inbox"></i>
              <h3>No stores found</h3>
              <p>Try adjusting your search or filters</p>
            `;
            row.appendChild(cell);
            body.appendChild(row);
            return;
          }

          paginatedData.forEach((rowData) => {
            const row = document.createElement("tr");
            if (this.onRowClick) {
              row.style.cursor = "pointer";
              row.addEventListener("click", () => this.onRowClick(rowData));
            }
            this.schema
              .filter((col) => this.state.visibleColumns.includes(col.key))
              .forEach((col) => {
                const td = document.createElement("td");
                td.textContent = this.formatValue(rowData[col.key], col);
                row.appendChild(td);
              });
            if (this.schema.some((col) => col.actions)) {
              const td = document.createElement("td");
              td.className = "actions";
              const actions = this.schema.find((col) => col.actions)?.actions;
              if (actions) {
                actions.forEach((action) => {
                  const btn = document.createElement("button");
                  btn.className = `action-btn ${action.type || ""}`;
                  btn.innerHTML = `<i class="fas fa-${action.icon}"></i> ${action.label}`;
                  btn.addEventListener("click", (e) => {
                    e.stopPropagation();
                    if (this.onAction) {
                      this.onAction(action.key, rowData);
                    }
                  });
                  td.appendChild(btn);
                });
              }
              row.appendChild(td);
            }
            body.appendChild(row);
          });
        }

        formatValue(value, column) {
          if (value === null || value === undefined) return "-";
          if (column.format) {
            return column.format(value);
          }
          if (column.type === "date") {
            return new Date(value).toLocaleDateString();
          }
          return String(value);
        }

        getFilteredData() {
          let filtered = [...this.data];

          // Apply search
          if (this.state.search) {
            const searchLower = this.state.search.toLowerCase();
            filtered = filtered.filter((row) => {
              return this.schema.some((col) => {
                const value = String(row[col.key] || "").toLowerCase();
                return value.includes(searchLower);
              });
            });
          }

          // Apply filters with operators
          this.state.filters.forEach((filter) => {
            if (!filter.value) return;

            const col = this.schema.find((c) => c.key === filter.field);
            if (!col) return;

            filtered = filtered.filter((row) => {
              const cellValue = row[filter.field];
              const filterValue = filter.value;
              const fieldType = this.getFieldType(col);

              return this.applyFilterOperator(
                cellValue,
                filterValue,
                filter.operator,
                fieldType
              );
            });
          });

          // Apply sorting
          if (this.state.sortColumn) {
            filtered.sort((a, b) => {
              const aVal = a[this.state.sortColumn];
              const bVal = b[this.state.sortColumn];
              const multiplier = this.state.sortDirection === "asc" ? 1 : -1;
              if (aVal < bVal) return -1 * multiplier;
              if (aVal > bVal) return 1 * multiplier;
              return 0;
            });
          }

          return filtered;
        }

        applyFilterOperator(cellValue, filterValue, operator, fieldType) {
          if (cellValue === null || cellValue === undefined) return false;

          if (fieldType === "string") {
            const cellStr = String(cellValue).toLowerCase();
            const filterStr = String(filterValue).toLowerCase();

            switch (operator) {
              case "contains":
                return cellStr.includes(filterStr);
              case "equals":
                return cellStr === filterStr;
              case "startsWith":
                return cellStr.startsWith(filterStr);
              case "endsWith":
                return cellStr.endsWith(filterStr);
              case "notContains":
                return !cellStr.includes(filterStr);
              default:
                return true;
            }
          } else if (fieldType === "number") {
            const cellNum = Number(cellValue);
            const filterNum = Number(filterValue);
            if (isNaN(cellNum) || isNaN(filterNum)) return false;

            switch (operator) {
              case "equals":
                return cellNum === filterNum;
              case "greaterThan":
                return cellNum > filterNum;
              case "lessThan":
                return cellNum < filterNum;
              case "greaterThanOrEqual":
                return cellNum >= filterNum;
              case "lessThanOrEqual":
                return cellNum <= filterNum;
              case "notEquals":
                return cellNum !== filterNum;
              default:
                return true;
            }
          } else if (fieldType === "date") {
            const cellDate = new Date(cellValue);
            const filterDate = new Date(filterValue);
            if (isNaN(cellDate.getTime())) return false;

            switch (operator) {
              case "equals":
                return cellDate.toDateString() === filterDate.toDateString();
              case "before":
                return cellDate < filterDate;
              case "after":
                return cellDate > filterDate;
              case "between":
                const parts = filterValue.split(",");
                if (parts.length !== 2) return false;
                const startDate = new Date(parts[0]);
                const endDate = new Date(parts[1]);
                if (isNaN(startDate.getTime()) || isNaN(endDate.getTime()))
                  return false;
                return cellDate >= startDate && cellDate <= endDate;
              default:
                return true;
            }
          }

          return true;
        }

        getPaginatedData(data) {
          const start = (this.state.currentPage - 1) * this.state.pageSize;
          const end = start + this.state.pageSize;
          return data.slice(start, end);
        }

        renderPagination() {
          const filteredData = this.getFilteredData();
          const totalPages = Math.ceil(
            filteredData.length / this.state.pageSize
          );
          const info = document.getElementById("paginationInfo");
          const pageNumbers = document.getElementById("pageNumbers");
          const prevBtn = document.getElementById("prevBtn");
          const nextBtn = document.getElementById("nextBtn");
          const pageSizeSelect = document.getElementById("pageSizeSelect");

          if (info) {
            const start =
              (this.state.currentPage - 1) * this.state.pageSize + 1;
            const end = Math.min(
              start + this.state.pageSize - 1,
              filteredData.length
            );
            info.textContent = `Showing ${start}-${end} of ${filteredData.length} stores`;
          }

          if (pageNumbers) {
            pageNumbers.innerHTML = "";
            const maxPages = 5;
            let startPage = Math.max(
              1,
              this.state.currentPage - Math.floor(maxPages / 2)
            );
            let endPage = Math.min(totalPages, startPage + maxPages - 1);
            if (endPage - startPage < maxPages - 1) {
              startPage = Math.max(1, endPage - maxPages + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
              const btn = document.createElement("button");
              btn.className = `pagination-btn ${
                i === this.state.currentPage ? "active" : ""
              }`;
              btn.textContent = i;
              btn.addEventListener("click", () => {
                this.state.currentPage = i;
                this.renderTable();
                this.renderPagination();
                this.updateURL();
              });
              pageNumbers.appendChild(btn);
            }
          }

          if (prevBtn) {
            prevBtn.disabled = this.state.currentPage === 1;
            prevBtn.addEventListener("click", () => {
              if (this.state.currentPage > 1) {
                this.state.currentPage--;
                this.renderTable();
                this.renderPagination();
                this.updateURL();
              }
            });
          }

          if (nextBtn) {
            nextBtn.disabled = this.state.currentPage >= totalPages;
            nextBtn.addEventListener("click", () => {
              if (this.state.currentPage < totalPages) {
                this.state.currentPage++;
                this.renderTable();
                this.renderPagination();
                this.updateURL();
              }
            });
          }

          if (pageSizeSelect) {
            pageSizeSelect.value = this.state.pageSize;
            pageSizeSelect.addEventListener("change", (e) => {
              this.state.pageSize = parseInt(e.target.value);
              this.state.currentPage = 1;
              this.renderTable();
              this.renderPagination();
              this.updateURL();
            });
          }
        }

        attachEventListeners() {
          // Search with debounce
          let searchTimeout;
          const searchInput = document.getElementById("searchInput");
          if (searchInput) {
            searchInput.addEventListener("input", (e) => {
              clearTimeout(searchTimeout);
              searchTimeout = setTimeout(() => {
                this.state.search = e.target.value;
                this.state.currentPage = 1;
                this.renderTable();
                this.renderPagination();
                this.updateURL();
              }, 300);
            });
          }

          // Filter Popover
          const filterPopover = document.getElementById("filterPopover");
          const addFilterBtn = document.getElementById("addFilterBtn");
          const popoverClose = document.getElementById("popoverClose");
          const applyFiltersBtn = document.getElementById("applyFiltersBtn");
          const clearFiltersBtn = document.getElementById("clearFiltersBtn");

          if (addFilterBtn) {
            addFilterBtn.addEventListener("click", (e) => {
              e.stopPropagation();
              this.renderFiltersPopover();
              if (filterPopover) {
                filterPopover.classList.toggle("show");
                if (filterPopover.classList.contains("show")) {
                  addFilterBtn.classList.add("active");
                } else {
                  addFilterBtn.classList.remove("active");
                }
              }
            });
          }

          if (popoverClose) {
            popoverClose.addEventListener("click", () => {
              if (filterPopover) {
                filterPopover.classList.remove("show");
                if (addFilterBtn) {
                  addFilterBtn.classList.remove("active");
                }
              }
            });
          }

          // Close popover when clicking outside
          document.addEventListener("click", (e) => {
            if (
              filterPopover &&
              !filterPopover.contains(e.target) &&
              !addFilterBtn.contains(e.target) &&
              filterPopover.classList.contains("show")
            ) {
              filterPopover.classList.remove("show");
              if (addFilterBtn) {
                addFilterBtn.classList.remove("active");
              }
            }
          });

          if (applyFiltersBtn) {
            applyFiltersBtn.addEventListener("click", () => {
              this.state.currentPage = 1;
              this.renderTable();
              this.renderPagination();
              this.updateURL();
              this.updateFilterCount();
              if (filterPopover) {
                filterPopover.classList.remove("show");
                if (addFilterBtn) {
                  addFilterBtn.classList.remove("active");
                }
              }
            });
          }

          if (clearFiltersBtn) {
            clearFiltersBtn.addEventListener("click", () => {
              this.state.filters = [];
              this.state.currentPage = 1;
              this.renderFiltersPopover();
              this.renderTable();
              this.renderPagination();
              this.updateURL();
              this.updateFilterCount();
            });
          }

          // Column toggle dropdown
          const columnToggleBtn = document.getElementById("columnToggleBtn");
          const columnDropdown = document.getElementById("columnDropdown");
          if (columnToggleBtn && columnDropdown) {
            columnToggleBtn.addEventListener("click", (e) => {
              e.stopPropagation();
              columnDropdown.classList.toggle("show");
            });
            document.addEventListener("click", (e) => {
              if (
                !columnDropdown.contains(e.target) &&
                !columnToggleBtn.contains(e.target)
              ) {
                columnDropdown.classList.remove("show");
              }
            });
          }
        }

        updateData(newData) {
          this.data = newData;
          this.renderControls();
          this.renderTable();
          this.renderPagination();
        }
      }

      // Sample data
      const storesData = [
        {
          id: "1",
          name: "Main Store",
          createdAt: "2024-01-15T10:00:00Z",
          updatedAt: "2024-01-20T14:30:00Z",
        },
        {
          id: "2",
          name: "Downtown Branch",
          createdAt: "2024-01-16T09:00:00Z",
          updatedAt: "2024-01-21T11:20:00Z",
        },
        {
          id: "3",
          name: "Tech Hub",
          createdAt: "2024-01-17T08:00:00Z",
          updatedAt: "2024-01-22T16:45:00Z",
        },
        {
          id: "4",
          name: "West Branch",
          createdAt: "2024-01-18T10:30:00Z",
          updatedAt: "2024-01-23T09:15:00Z",
        },
        {
          id: "5",
          name: "East Branch",
          createdAt: "2024-01-19T11:00:00Z",
          updatedAt: "2024-01-24T13:30:00Z",
        },
        {
          id: "6",
          name: "North Plaza",
          createdAt: "2024-01-20T12:00:00Z",
          updatedAt: "2024-01-25T10:00:00Z",
        },
        {
          id: "7",
          name: "South Center",
          createdAt: "2024-01-21T13:00:00Z",
          updatedAt: "2024-01-26T15:20:00Z",
        },
        {
          id: "8",
          name: "Central Mall",
          createdAt: "2024-01-22T14:00:00Z",
          updatedAt: "2024-01-27T11:45:00Z",
        },
      ];

      // Schema definition for stores
      const storesSchema = [
        {
          key: "id",
          label: "ID",
          sortable: true,
          filterable: false,
        },
        {
          key: "name",
          label: "Store Name",
          sortable: true,
          filterable: true,
        },
        {
          key: "createdAt",
          label: "Created At",
          type: "date",
          sortable: true,
          filterable: false,
          format: (value) => new Date(value).toLocaleDateString(),
        },
        {
          key: "updatedAt",
          label: "Updated At",
          type: "date",
          sortable: true,
          filterable: false,
          format: (value) => new Date(value).toLocaleDateString(),
        },
        {
          key: "actions",
          label: "Actions",
          actions: [
            {
              key: "view",
              label: "View",
              icon: "eye",
              type: "view",
            },
            {
              key: "edit",
              label: "Edit",
              icon: "edit",
              type: "edit",
            },
            {
              key: "delete",
              label: "Delete",
              icon: "trash",
              type: "delete",
            },
          ],
        },
      ];

      // Initialize DataTable
      const dataTable = new DataTable({
        schema: storesSchema,
        data: storesData,
        container: document.getElementById("tableWrapper"),
        onRowClick: (row) => {
          console.log("Row clicked:", row);
          // Navigate to store details
        },
        onAction: (action, row) => {
          console.log("Action:", action, "on row:", row);
          if (action === "delete") {
            if (confirm(`Are you sure you want to delete ${row.name}?`)) {
              // Handle delete
              console.log("Deleting:", row);
            }
          } else if (action === "edit") {
            // Handle edit
            console.log("Editing:", row);
          } else if (action === "view") {
            // Handle view
            console.log("Viewing:", row);
          }
        },
      });

      // Handle window resize
      window.addEventListener("resize", function () {
        if (window.innerWidth > 768) {
          sidebar.classList.remove("open");
        }
      });
    </script>
  </body>
</html>
